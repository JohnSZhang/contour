{"version":3,"file":"contour.geo.min.js","sources":["?","../src/scripts/geo.js","../src/scripts/map.js","../src/scripts/choropleth.js","../src/scripts/small-states-callout.js","../src/scripts/us-map.js","../src/scripts/version.js","../src/scripts/world-map.js"],"names":["exports","global","Contour","geo","map","data","layer","options","width","chart","plotWidth","height","plotHeight","opt","us","fillFn","fill","_","isFunction","noop","classFn","cssClass","scaleRatio","projection","scale","translate","translation","precision","center","path","d3","g","append","attr","feature","selectAll","topojson","objects","features","enter","d","id","datum","mesh","a","b","defaults","undefined","mercator","choropleth","this","ensureDefaults","merge","renderer","call","newCallout","index","node","select","origState","origClass","origFill","origStroke","centroid","__data__","line","textBox","rectWidth","offsetY","rectHeight","rectPadding","tbCentroid","getCentroid","text","smallStates","albersUsa","element","bbox","getBoundingClientRect","left","top","svg","each","USMap","version","w","h","miller","equirectangular","Math","PI","worldChoropleth"],"mappings":"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","sourcesContent":[null,"(function () {\n    Contour.geo = Contour.geo || {};\n})();\n","(function () {\n    'use strict';\n\n    var defaults = {\n        map: {\n            // topoJson feature to render as a map (will acccess topoJson.objects[options.feature])\n            feature: undefined,\n            // scale to be used by the projection,\n            // if left undefined, scale will be chart.plotWidth * scaleRatio\n            scale: undefined,\n            // a nice scale ratio\n            scaleRatio: 1.3333,\n            // valid options are at https://github.com/mbostock/d3/wiki/Geo-Projections\n            projection: d3.geo.mercator(),\n            // array of [longitute, latitude]\n            center: undefined,\n            // d3.geo.projection.precision()\n            precision: 0.1,\n            // translates the pixel coordinates of center based on array of [x, y]\n            translation: undefined,\n            // a class name or function that returns a class name to be set onto each feature\n            cssClass: undefined,\n            // a color (hex) or function that returns a color to be set onto each feature\n            fill: undefined\n        }\n    };\n\n\n    /**\n    * Adds a map visualization to the Contour instance. Default configuration options are designed for a US map with an Albers USA projection.\n    *\n    * map visualizations require a TopoJSON file with the topology to draw. Because of this, typically map visualizations are created as part of a callback function passed to a `d3.json()` call that parses the TopoJSON file.\n    *\n    * When you [download Contour-Geo](get_contour.html), a few TopoJSON files are included. You can also [create your own](#topojosn).\n    *\n    * ### Example:\n    *\n    *       d3.json('us-states.json', function (us) {\n    *           new Contour({\n    *                   el: '.map',\n    *                   map: {\n    *                       projection: d3.geo.albers()\n    *                   }\n    *               })\n    *               .map(us)\n    *               .render();\n    *       });\n    *\n    *\n    * @name map(data, options)\n    * @param {object} data The data (topology) to be rendered with this visualization. This must be in TopoJSON format.\n    * @param {object} options (Optional) Configuration options particular to this visualization that override the defaults.\n    */\n    function map(data, layer, options) {\n        var width = options.chart.plotWidth;\n        var height = options.chart.plotHeight;\n        var opt = options.map || {};\n        var us = data;\n        var fillFn = !opt.fill ? _.noop : _.isFunction(opt.fill) ? opt.fill : function () { return opt.fill; };\n        var classFn = !opt.cssClass ? _.noop : _.isFunction(opt.cssClass) ? opt.cssClass : function () { return opt.cssClass; };\n        var scaleRatio = options.map.scaleRatio;\n\n\n        var projection = options.map.projection\n            .scale(options.map.scale || width * scaleRatio)\n            .translate(options.map.translation || [width / 2, height / 2])\n            .precision(options.map.precision);\n\n        if (projection.center) {\n            projection.center(options.map.center || [0,0]);\n        }\n\n        var path = d3.geo.path()\n            .projection(projection);\n\n        var g = layer;\n\n        g.append('g').attr('id', options.map.feature)\n            .selectAll('path')\n                .data(topojson.feature(us, us.objects[options.map.feature]).features)\n            .enter().append('path')\n                .attr('id', function (d) { return d.id; })\n                .attr('class', function(d) { return 'tooltip-tracker state ' + classFn(d); })\n                .attr('fill', fillFn)\n                .attr('d', path);\n\n        g.append('path')\n            .datum(topojson.mesh(us, us.objects[options.map.feature]), function(a, b) { return a !== b; })\n            .attr('id', 'state-borders')\n            .attr('d', path);\n    }\n\n    map.defaults = defaults;\n\n    Contour.export('map', map);\n})();\n","(function () {\n    'use strict';\n\n    var defaults = {\n        choropleth: {\n        }\n    };\n\n\n    /**\n    * Adds a choropleth map visualization to the Contour instance. A [Choropleth map](http://en.wikipedia.org/wiki/Choropleth_map) is the most comon type of thematic maps for visualizing statistical data.\n    *\n    * Choropleth visualizations require a TopoJSON file with the topology to draw. Because of this, typically choropleth visualizations are created as part of a callback function passed to a `d3.json()` call that parses the TopoJSON file.\n    *\n    * When you [download Contour-Geo](get_contour.html), a few TopoJSON files are included. You can also [create your own](#topojosn).\n    *\n    * ### Example:\n    *\n    *       d3.json('us-states.json', function (us) {\n    *           new Contour({\n    *                   el: '.map',\n    *                   choropleth: {\n    *                       projection: d3.geo.albers()\n    *                   }\n    *               })\n    *               .choropleth(us)\n    *               .render();\n    *       });\n    *\n    *\n    * @name choropleth(data, options)\n    * @param {object} data The data (topology) to be rendered with this visualization. This must be in TopoJSON format.\n    * @param {object} options (Optional) Configuration options particular to this visualization that override the defaults.\n    */\n    var choropleth = function (data, layer, options) {\n        this.ensureDefaults(options, 'map');\n\n        options.map = options.map || {};\n        _.merge(options.map, options.choropleth);\n\n        return this.map.renderer.call(this, data, layer, options);\n    };\n\n    choropleth.defaults = defaults;\n\n    Contour.export('choropleth', choropleth);\n})();\n","(function () {\n    'use strict';\n\n    /**\n    * Adds callouts for several of the smaller states on the East Coast of the US.\n    *\n    * This visualization requires `.map()` and is suitable for use with the default `us.json` and `us-all.json` TopoJSON files included with Contour-Geo.\n    *\n    * ### Example:\n    *\n    *       d3.json('us-all.json', function (us) {\n    *           new Contour({ el: '.map' })\n    *               .map(us)\n    *               .smallStatesCallouts()\n    *               .render()\n    *       });\n    *\n    * @name smallStatesCallouts(data, options)\n    * @param {object} data The data (topology) to be rendered with this visualization. This must be in TopoJSON format. By default takes the data from the map that is also part of this Contour instance.\n    * @param {object} options (Optional) Configuration options particular to this visualization that override the defaults.\n    */\n\n    Contour.export('smallStatesCallouts', function (data, layer, options) {\n        var smallStates = ['NH', 'VT', 'MA', 'RI', 'CT', 'NJ', 'DE', 'MD'];\n        var width = options.chart.plotWidth;\n        var height = options.chart.plotHeight;\n        var scaleRatio = options.map.scaleRatio;\n\n        var projection = d3.geo.albersUsa()\n            .scale(options.map.scale || width * scaleRatio)\n            .translate([width / 2, height / 2]);\n\n        var path = d3.geo.path()\n            .projection(projection);\n\n        var getCentroid = function (element) {\n            var bbox = element.getBoundingClientRect();\n\n            return [bbox.left + bbox.width/2, bbox.top + bbox.height/2];\n        };\n\n        var map = this.svg.select('#states');\n        var rectHeight = 20;\n        var rectWidth = 20;\n        var rectPadding = 5;\n        var offsetY = 70;\n\n        function newCallout(d, index) {\n            var node = d3.select(this);\n            var origState = map.select('#' + d);\n            var origClass = origState.attr('class');\n            var origFill = origState.attr('fill');\n            var origStroke = origState.attr('stroke');\n            var centroid = path.centroid(origState.node().__data__);\n            var line = node.append('line')\n                .attr('x1', centroid[0])\n                .attr('y1', centroid[1]);\n\n            var textBox = node.append('g')\n                .attr('transform', function () {\n                    return 'translate(' + (width - rectWidth) + ',' + (offsetY + rectHeight * index + (rectPadding - 1) * index) + ')';\n                });\n\n            var tbCentroid = getCentroid(textBox.node());\n\n            line.attr('x2', tbCentroid[0])\n                .attr('y2', tbCentroid[1]);\n\n            textBox.append('rect')\n                .datum(origState.node().__data__)\n                .attr('x', 0)\n                .attr('y', 0)\n                .attr('width', rectWidth)\n                .attr('height', rectHeight)\n                .attr('class', origClass)\n                .attr('fill', origFill)\n                .attr('stroke', origStroke);\n\n            textBox.append('text')\n                .text(d)\n                .attr('y', rectHeight / 2)\n                .attr('dy', '.31em')\n                .attr('x', rectWidth / 2);\n        }\n\n        var g = layer.selectAll('.small-state-callout').data(smallStates);\n\n        g.enter().append('g')\n            .attr('class', 'small-state-callout')\n            .each(newCallout);\n    });\n})();\n","(function () {\n    'use strict';\n\n    var renderer = function (data, layer, options) {\n        this.ensureDefaults(options, 'choropleth');\n\n        options.choropleth = options.choropleth || {};\n        _.merge(options.choropleth, {\n            projection: d3.geo.albersUsa(),\n            feature: 'states'\n        }, options.USMap);\n\n        return this.choropleth.renderer.call(this, data, layer, options);\n    };\n\n    Contour.export('USMap', renderer);\n})();\n","Contour.geo.version = '0.9.109';","(function () {\n    'use strict';\n\n    var renderer = function (data, layer, options) {\n        this.ensureDefaults(options, 'choropleth');\n\n        var w = options.chart.plotWidth;\n        var h = options.chart.plotHeight;\n\n        // use miller projection if its available.\n        // needs to include <script src=\"http://d3js.org/d3.geo.projection.v0.min.js\" charset=\"utf-8\"></script>\n        // https://github.com/d3/d3-geo-projection\n        options.choropleth = options.choropleth || {};\n        _.merge(options.choropleth, {\n            feature: 'all',\n            projection: (d3.geo.miller || d3.geo.equirectangular)(),\n            scale: (w + 1) / 2 / Math.PI,\n            precision: 0.1,\n            translation: [w/2, h/2]\n        }, options.worldChoropleth);\n\n        return this.choropleth.renderer.call(this, data, layer, options);\n    };\n\n\n    Contour.export('worldMap', renderer);\n})();\n"]}